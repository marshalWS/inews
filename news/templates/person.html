{%load static %}<!DOCTYPE html>
<html>

	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<meta http-equiv="x-dns-prefetch-control" content="on">

		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="renderer" content="webkit">

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, minimal-ui">

		<meta name="baidu-site-verification" content="T239HZAbh7">
		<title>我的主页 </title>

		<meta name="format-detection" content="telephone=no">
		<link href="https://cdn.bootcss.com/cropper/3.1.3/cropper.min.css" rel="stylesheet">
		<link href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
		<style type="text/css">
			body {
				text-align: center;
			}
			
			#user-photo {
				width: 300px;
				height: 300px;
				margin-top: 10px;
			}
			
			#photo {
				max-width: 100%;
				max-height: 350px;
			}
			
			.img-preview-box {
				text-align: center;
			}
			
			.img-preview-box>div {
				display: inline-block;
				;
				margin-right: 10px;
			}
			
			.img-preview {
				overflow: hidden;
			}
			
			.img-preview-box .img-preview-lg {
				width: 150px;
				height: 150px;
			}
			
			.img-preview-box .img-preview-md {
				width: 100px;
				height: 100px;
			}
			
			.img-preview-box .img-preview-sm {
				width: 50px;
				height: 50px;
				border-radius: 50%;
			}
		</style>
		<link rel="stylesheet" href="{% static 'css/layout_f4855e3.css'%}">

		<link rel="stylesheet" href="{% static 'css/profile_ca978ee.css'%}">

	</head>

	<body style="min-width: 768px; overflow-x: hidden;">
		<div style="display:none"><input type="hidden" name="csrfmiddlewaretoken" value="db4b9ffde251d7c62edccd8449a434d4"></div>

		<a href="" style="display:none;"></a>

		<div class="y-wrap">

			<!-- 公共头部 -->
			<div id="header">
				<div riot-tag="wtopbar" style="height: 34px; background: #222;">
					<div class="y-box wtopbar">
						<div class="y-left y-nav-topbar" riot-tag="nav">
							<div class="nav">

							</div>
						</div>
						<ul class="y-right">
							<li class="tb-item userbox">
								<div riot-tag="wuserbox" abtype="" pageid="">
									<div class="y-box wuserbox">
										
									</div>
								</div>
							</li>
							
						</ul>
						<div id="J_userFeedback"></div>
					</div>
				</div>

				<div class="middlebar">
					<div class="y-box middlebar-inner">
						<div class="y-left logo-box">
							<a class="logo-link" href=".." ga_event="go_home">
								<img class="logo" src="{%static 'images/logo.png'%}">
							</a>
						</div>

						<div class="y-right">
							<div riot-tag="wsearch" style="margin-top: 9px; width: 340px;">
								<div name="searchBox" class="wsearch">
									<form name="searchForm" action="#search" method="get" target="_blank">
										<div name="inputbox" class="y-box input-group"> <input class="y-left input-text" name="keyword" autocomplete="off" ga_event="mh_search" type="text" placeholder="请输入关键字">
											<div class="y-right btn-submit"> <button type="submit" href="javascript:;"> <i class="y-icon icon-search" ga_event="mh_search"></i> </button> </div>
										</div>
									</form>
								</div>
							</div>
						</div>
					</div>
				</div>

			</div>

			<div riot-tag="login">
				<div class="login-dialog hide">
					<a class="btn" href="javascript:;"> <i class="icon icon-close"></i> </a>
					<div class="login-dialog-header">
						<h3>邮箱登录</h3> </div>
					<div class="login-dialog-inner" data-node="inner">
						<div class="login-pannel bottom-line">
							<form action="" method="POST">
								
							</form>
						</div>
						<div class="login-dialog-header">
							<h3>合作网站账号登录</h3> </div>
						<div class="">
							<ul class="y-box sns_login_list">
								<li class="sinaweibo">
									<a href="javascript:;" data-pid="sina_weibo" ga_event="login_sina_weibo"> <i class="icon"></i> 新浪微博 </a>
								</li>
								<li class="qqweibo">
									<a href="javascript:;" data-pid="qq_weibo" ga_event="login_tencnet_weibo"> <i class="icon"></i> 腾讯微博 </a>
								</li>
								<li class="qzone">
									<a href="javascript:;" data-pid="qzone_sns" ga_event="login_qqzone"> <i class="icon"></i> QQ空间 </a>
								</li>
								<li class="renren">
									<a href="javascript:;" data-pid="renren_sns" ga_event="login_renren"> <i class="icon"></i> 人人网 </a>
								</li>
								<li class="weixin">
									<a href="javascript:;" style="margin-right:0;" data-pid="weixin" ga_event="login_wechat"> <i class="icon"></i> 微信 </a>
								</li>
							</ul>
						</div>
					</div>
				</div>
				<div class="mask hide"></div>
			</div>
			<div id="toast"></div>

			<div id="wrapper">
				<div riot-tag="yheader" class="yheader">
					<img class="bg-header" id="bgphoto" data-target="#changeModal" data-toggle="modal" src="..img/{{user.bg_img}}.jpg"></a>
					<div>
						<img class="avatar" id="headerphoto" data-target="#changeModal" data-toggle="modal" src="..img/{{user.head_img}}.jpg"></a>
						<ul>
							<li class="title">
							</li>
							<li class="des">
							</li>
						</ul>
					</div>
				</div>
				<div class="left">
					<div riot-tag="tab">
						<ul class="tab tab-0">
							<li class="active" code="b" idx="0">视频</li>
							<li class="" code="c" idx="1">收藏</li>
							<!--riot placeholder-->
						</ul>
					</div>
					<div riot-tag="feedBox">
						<div class="feedBox" name="feedbox">
							<div class="tt-declare">以下内容由今日头条提供</div>
							<div class="tt-related-title">相关推荐</div>
							<div riot-tag="relatedFeed" ban="false" page_type="0" empty="true">
								<div class="relatedFeed">
									<ul>
										<!--riot placeholder-->
										<li class="empty">暂无内容</li>
									</ul>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="right">
					<div riot-tag="statistics">
						<dl class="statistics"> <dt> <a ga_event="nav_user_list" href="https://www.toutiao.com/c/user/relation/6021715781/?tab=following"> <h3 riot-tag="number" number="0"><em class="y-number"><i>0</i></em></h3> <p>关注</p> </a> </dt>
							<dd>
								<a ga_event="nav_user_list" href="https://www.toutiao.com/c/user/relation/6021715781/?tab=followed">
									<h3 riot-tag="number" number="6"><em class="y-number"><i>6</i></em></h3>
									<p>粉丝</p>
								</a>
							</dd>
						</dl>
					</div>
					<div riot-tag="recent"></div>
				</div>
				<div riot-tag="top"></div>
			</div>
			<div class="footer-push"></div>
			<div riot-tag="ugcBox"></div>

		</div>

		<div id="footer">
			<div>
				<span class="fitem">© 2019 今日头条 </span>
				<a class="fitem" href="http://www.12377.cn/" target="_blank">中国互联网举报中心</a>
				<a class="fitem" href="http://www.miibeian.gov.cn/" target="_blank">京ICP证140141号</a>
				<a class="fitem" href="http://www.miibeian.gov.cn/" target="_blank">京ICP备12025439号-3</a>
				<a class="fitem" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=11000002002023" target="_blank" ga_event="click_about">
					<img src="./person_files/gongan_d0289dc.png">京公网安备 11000002002023号
				</a>
			</div>
			<div>
				<span class="fitem">违法和不良信息举报电话：400-140-2108</span>

			</div>
		</div>

		
		<div class="modal fade" id="changeModal" tabindex="-1" role="dialog" aria-hidden="true">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
						<h4 class="modal-title text-primary">
            <i class="fa fa-pencil"></i>
                        更换头像
            </h4>
					</div>
					<div class="modal-body">
						<p class="tip-info text-center">
							未选择图片
						</p>
						<div class="img-container hidden">
							<img src="" alt="" id="photo">
						</div>
						<div class="img-preview-box hidden">
							<hr>
							<span>150*150:</span>
							<div class="img-preview img-preview-lg">
							</div>
							<span>100*100:</span>
							<div class="img-preview img-preview-md">
							</div>
							<span>30*30:</span>
							<div class="img-preview img-preview-sm">
							</div>
						</div>
					</div>
					<div class="modal-footer">
						<label class="btn btn-danger pull-left" for="photoInput">
            <input type="file" class="sr-only" id="photoInput" accept="image/*">
            <span>打开图片</span>
            </label>

						<button class="btn btn-primary disabled" disabled="true" onclick="sendPhoto(imgPlace);">提交</button>

						<button class="btn btn-close" aria-hidden="true" data-dismiss="modal">取消</button>
					</div>
				</div>
			</div>
		</div>

		<script src="https://cdn.bootcss.com/jquery/2.1.0/jquery.min.js"></script>
		<script src="https://cdn.bootcss.com/cropper/3.1.3/cropper.min.js"></script>
		<script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
		<script type="text/javascript">
			var imgPlace;
			var url;
			var img_type;
			var initCropperInModal = function(img, input, modal) {
				var $image = img;
				var $inputImage = input;
				var $modal = modal;
				var options = {
					aspectRatio: 1, // 纵横比
					viewMode: 2,
					preview: '.img-preview' // 预览图的class名
				};
				// 模态框隐藏后需要保存的数据对象
				var saveData = {};
				var URL = window.URL || window.webkitURL;
				var blobURL;
				$modal.on('show.bs.modal', function() {
					// 如果打开模态框时没有选择文件就点击“打开图片”按钮
					if(!$inputImage.val()) {
						$inputImage.click();
					}
				}).on('shown.bs.modal', function() {
					// 重新创建
					$image.cropper($.extend(options, {
						ready: function() {
							// 当剪切界面就绪后，恢复数据
							if(saveData.canvasData) {
								$image.cropper('setCanvasData', saveData.canvasData);
								$image.cropper('setCropBoxData', saveData.cropBoxData);
							}
						}
					}));
				}).on('hidden.bs.modal', function() {
					// 保存相关数据
					saveData.cropBoxData = $image.cropper('getCropBoxData');
					saveData.canvasData = $image.cropper('getCanvasData');
					// 销毁并将图片保存在img标签
					$image.cropper('destroy').attr('src', blobURL);
				});
				if(URL) {
					$inputImage.change(function() {
						var files = this.files;
						var file;
						if(!$image.data('cropper')) {
							return;
						}
						if(files && files.length) {
							file = files[0];

							if(/^image\/\w+$/.test(file.type)) {

								if(blobURL) {

									URL.revokeObjectURL(blobURL);

								}
								blobURL = URL.createObjectURL(file);
								url = blobURL.substring(blobURL.lastIndexOf('/') + 1, blobURL.length);

								// 重置cropper，将图像替换
								$image.cropper('reset').cropper('replace', blobURL);

								// 选择文件后，显示和隐藏相关内容
								$('.img-container').removeClass('hidden');
								$('.img-preview-box').removeClass('hidden');
								$('#changeModal .disabled').removeAttr('disabled').removeClass('disabled');
								$('#changeModal .tip-info').addClass('hidden');

							} else {
								window.alert('请选择一个图像文件！');
							}
						}
					});
				} else {
					$inputImage.prop('disabled', true).addClass('disabled');
				}
			}
			var sendPhoto = function(imgPlace) {
				// 得到PNG格式的dataURL
				var photo = $('#photo').cropper('getCroppedCanvas', {
					width: 300,
					height: 300
				});
				p = photo.toDataURL('image/png');
				blob=photo.toBlob;
				$.ajax({
					url: "{%url 'news:upload'%}", // 要上传的地址
					type: 'POST',
					data: {
						'imgData': p ,
						'imgname': url ,
						'csrfmiddlewaretoken': '{{ csrf_token }}',
						'type':img_type
					},
					dataType: 'text',
					
					success: function (result) {
						
						alert(result);

					$('#changeModal').modal('hide');
					}
			     
			   
			       
			
				});
			}

			$(function() {
				initCropperInModal($('#photo'), $('#photoInput'), $('#changeModal'));
			});

			$(document).ready(function() {
				$("#bgphoto").click(function() {
					imgPlace = '#bgphoto';
					img_type='headimg';
				});
			});

			$(document).ready(function() {
				$("#headerphoto").click(function() {
					imgPlace = '#headerphoto';
					img_type='bgimg';
				});
			});
		</script>

	</body>

</html>